services:
  frigate:
    image: ghcr.io/blakeblackshear/frigate:stable
    restart: unless-stopped

    privileged: true

    # 2G SHM to bylo za malo nawet na v1 kamer u nas
    shm_size: 4G
    mem_limit: 8G

    devices:
#      - /dev/dri/renderD128
      - /dev/bus/usb:/dev/bus/usb

    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./config:/config
      - /data/frigate:/media/frigate
#      - ./frigate-tmp:/tmp/cache # Spr√≥bujmy z cache w RAM :D
      - type: tmpfs
        target: /tmp/cache
        tmpfs:
          size: 3G

    ports:
      - "8666:8666/tcp" # WebRTC over tcp
      - "8666:8666/udp" # WebRTC over udp
      - "5080:5000/tcp" # webpanel
    labels:
      - homepage.group=Security
      - homepage.name=Frigate
      - homepage.icon=frigate.svg
      - homepage.href=http://flatsun.at.hskrk.pl:5080
      - homepage.description=Camera NVR
      - homepage.widget.type=frigate
      - homepage.widget.url=http://flatsun.at.hskrk.pl:5080
    networks:
      - frigate
      - services-monitoring
      - mqtt
    secrets:
      - FRIGATE_MQTT_PASSWORD
networks:
    frigate:
secrets:
    FRIGATE_MQTT_PASSWORD: # Secret must be all named with all caps so that frigate picks it up
        file: /opt/secrets/frigate_mqtt_password.txt
